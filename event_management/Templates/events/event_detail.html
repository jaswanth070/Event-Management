{% extends "Dashboards/base.html" %}

{% block title %}Event Details{% endblock title %}

{% block content %}
<div class="container">
    <h2>Event Details</h2>
    <form id="eventForm">
        <div class="form-group">
            <label for="eventName">Name</label>
            <input type="text" id="eventName" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label for="eventDescription">Description</label>
            <textarea id="eventDescription" class="form-control" readonly></textarea>
        </div>
        <div class="form-group">
            <label for="eventDate">Date</label>
            <input type="date" id="eventDate" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label for="eventTime">Time</label>
            <input type="time" id="eventTime" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label for="eventCompleted">Completed</label>
            <input type="checkbox" id="eventCompleted" disabled>
        </div>
        <div class="form-group">
            <label for="eventRegistration">Accept Registrations</label>
            <input type="checkbox" id="eventRegistration" disabled>
        </div>
        <button type="button" id="editBtn" class="btn btn-primary">Edit</button>
        <button type="button" id="saveBtn" class="btn btn-success" style="display:none;">Save</button>
        <button type="button" id="cancelBtn" class="btn btn-danger" style="display:none;">Cancel</button>
    </form>
</div>
{% endblock %}

{% block extra_script %}
<script>
    const eventId = "{{ event_id }}";  // Event ID passed in the context
    const apiUrl = `/events/event/${eventId}/`;
    
    // Fetch event details
    $(document).ready(function () {
        $.get(apiUrl, function (data) {
            $("#eventName").val(data.name);
            $("#eventDescription").val(data.description);
            $("#eventDate").val(data.date);
            $("#eventTime").val(data.time);
            $("#eventCompleted").prop("checked", data.is_completed);
            $("#eventRegistration").prop("checked", data.accept_registrations);
        });
    });

    // Enable editing
    $("#editBtn").click(function () {
        $("input, textarea").prop("readonly", false);
        $("#eventCompleted, #eventRegistration").prop("disabled", false);
        $("#editBtn").hide();
        $("#saveBtn, #cancelBtn").show();
    });

    // Save changes
    $("#saveBtn").click(function () {
        const updatedData = {
            name: $("#eventName").val(),
            description: $("#eventDescription").val(),
            date: $("#eventDate").val(),
            time: $("#eventTime").val(),
            is_completed: $("#eventCompleted").is(":checked"),
            accept_registrations: $("#eventRegistration").is(":checked"),
        };

        $.ajax({
            url: apiUrl,
            type: "PUT",
            data: JSON.stringify(updatedData),
            contentType: "application/json",
            success: function (response) {
                alert(response.message);
                location.reload();
            },
            error: function (xhr) {
                alert("An error occurred: " + xhr.responseText);
            },
        });
    });

    // Cancel editing
    $("#cancelBtn").click(function () {
        location.reload();
    });
</script>
{% endblock %}
